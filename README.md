# Приложение "Прокат велосипедов"

## О приложении

Представим, что вы работаете над стартапом, вы хотите создать в Новосибирске автоматизированную сеть по прокату велосипедов, работающую без продавцов. Велосипед можно взять и сдать в любом пункте проката. Чтобы взять велосипед, нужно только ввести код.
В приложении пользователь выбирает пункт выдачи, велосипед, и получает код. Естественно, кто попало это сделать не может, нужно авторизоваться и заполнить данные о банковской карте для оплаты.

## Начало работы

### Запуск сервера

- клонировать репозиторий <https://gitlab.com/nsk-front-school/server-rent-bike>
- npm i
- npm run start

### Запуск проекта

- npm i
- npm run start
- открыть в браузере <http://localhost:3000/>

Макеты - <https://www.figma.com/file/ZXpD8WcDKMNkqKMHcRlahi/%D0%A8%D0%BA%D0%BE%D0%BB%D0%B0-%D1%84%D1%80%D0%BE%D0%BD%D1%82%D0%B0?t=Ky144eYJgHnWihKD-0>

## Задания

В рамках изучения `React` основной задачей будет, закрепить опыт работы с хуками, списками, условным рендерингом. Поэтому попробуем реализовать небольшую часть приложения.

### Задание 0

- Ознакомьтесь с уже реализованными компонентами (`src/components`) и моделью для работы с `API` (`src/api`);
- Перепишите уже реализованные вами компоненты из своей ветки [репозитория с версткой](https://gitlab.com/nsk-front-school/rentbike) на `react functional components`

### Задание 1

Настройка роутинга. Для навигации в приложении без обновления страницы, такие приложения называются SPA, используется пакет `react-router-dom`. В пакете есть три основных компонента:

- `BrowserRouter`: корневой компонент, который необходим для работы всех остальных компонентов. Компонент сохраняет текущее местоположение в адресной строке браузера, используя чистые URL-адреса, и осуществляет навигацию, используя встроенный стек истории браузера;
- `Routes`: компонент, который осуществляет навигацию исходя из текущего `URL`. Всякий раз, когда местоположение изменяется, `Routes` просматривает все его дочерние маршруты, чтобы найти наилучшее соответствие по пропсу `path` с `URL` страницы, и отображает эту ветвь пользовательского интерфейса:
- `Route`: компонент, который позволяет задать на какой путь нужно рендерить компонент с помощью пропсов `path, element`.

**Важно** - компоненты `Routes, Route` должны быть расположены внутри `BrowserRouter`.

Подробнее о пакете можно [прочитать тут](https://reactrouter.com/en/main/start/tutorial)

Необходимо сделать следующие:

- В файле `src/App.tsx` добавьте компонент-обертку [BrowserRouter](https://reactrouter.com/en/main/router-components/browser-router);
- Настройте роутинг в файле `src/Router.tsx`, используя компоненты [Routes, Route](https://reactrouter.com/en/main/components/routes)

### Задание 2

Доработайте компонент `Layout` (`src/Layout`) и страницу `Main` (`src/pages/Main`).

- В `Layout` нужно добавить редирект пользователя на главную страницу приложения (`/`), если он не авторизован. Используйте хук `useNavigate` из `react-router-dom`. Подробнее о нем можно [прочитать тут](https://reactrouter.com/en/main/hooks/use-navigate);
- На странице `Main` при клике на кнопку "Выбрать велосипед" нужно отправлять пользователя на страницу каталога (используйте `useNavigate`).

### Задание 3

Реализуйте каталог велосипедов (`src/pages/Catalog`). Достаточно перенести верстку реализованную ранее, и добавить всю остальную механику.
Нужно реализовать:

- запрос данных с сервера, используя готовый метод апи (не забудьте передавать в метод текущую страницу и точку выдачи);
- сохранение точки выдачи в query параметр. Используйте хук `use-search-params` и из `react-router-dom` Подробнее о нем можно [прочитать тут](https://reactrouter.com/en/main/hooks/use-search-params).;
- перезапрос списка велосипедов при изменении точки выдачи или страницы в query параметрах;
- открытие карты в модальном окне с точками выдачи (по желанию можно настроить интеграцию с яндекс картами, точки произвольные).
- открытие модального окна при клике на велосипед;
- отправка данных для аренды велосипеда. Добавить методы генерации qr-code и начала аренды. (см описание механики ниже).

### Пояснения

**Пагинация**
Постраничная навигация (пейджинг или пагинация) — способ представления большого количества однородной информации, когда контент разбивается на страницы. Уже есть готовый компонент с минимально необходимой функциональность `src/components/Paging`. Подробнее о том как должен работать компонент, можно [почитать тут](https://guides.kontur.ru/components/paging/).

**Query параметры**
Query параметры - набор значений которые могут располагаться в любом URL в виде `key=value` после знака вопроса `?` и разделяются с помощью `&`. Например `https://kontur.ru/product/extern?school=true&userName=vova`.
Во фронтенде часто их используют, чтобы запоминать состояние фильтров, номер страницы и других значений, которые влияют на выборку данных. В каталоге необходимо хранить текущую точку выдачи и номер страницы каталога в query (для пагинации это уже сделано в компоненте).

**Механика аренды велосипеда**
После клика на кнопку "Арендовать" отправляем запрос `POST /api/order`. В ответ нам вернется объект, где поле `_id` отвечает за идентификатор аренды. По этому полю необходимо сгенерировать QR-CODE с помощью метода `GET /api/order/get-qrcode` и показать пользователю согласно прототипу. После сканирования пользователь получает ссылку вида `/books/{orderId}?action=start`. После перехода по ней необходимо вызвать метод `GET /api/order/rent` и в БД фиксируется время начала аренды. Оно будет возвращаться при запросе списка арендованных велосипедов.
_Какие данные ожидают методы и что возвращают можно узнать в [swagger документации АПИ](http://localhost:3010/api)._
